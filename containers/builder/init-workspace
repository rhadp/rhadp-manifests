# Execute all scripts in .scripts folder
set -e

INIT_SCRIPTS_DIR="${INIT_SCRIPTS_DIR:-/home/tooling/.scripts/startup}"

[ ! -d "$INIT_SCRIPTS_DIR" ] && { echo "error: $INIT_SCRIPTS_DIR not found"; exit 0; }

# Collect scripts from main INIT_SCRIPTS_DIR
scripts=$(find "$INIT_SCRIPTS_DIR" -type f | sort)

# Add scripts from local .scripts directory if it exists
if [ -d ".scripts" ]; then
    local_scripts=$(find ".scripts" -type f | sort)
    scripts="$scripts $local_scripts"
fi
[ -z "$scripts" ] && { echo "no init scripts found"; exit 0; }

for script in $scripts; do
    if [ -x "$script" ]; then
        echo "running: $script..."
        . "$script" || { echo "error: $script failed with exit code $?"; exit 1; }
    else
        echo "skipping: $script"
    fi
done